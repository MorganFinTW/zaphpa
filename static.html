<!DOCTYPE html>
<!--[if lt IE 9]><html class="ie"><![endif]-->
<!--[if gte IE 9]><!--><html><!--<![endif]-->

<!--
	The comment jumble above is handy for targeting old IE with CSS.
	http://paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/
-->
	
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
		<title>Golden Grid System Demo</title>
		
		<!-- Please don't add "maximum-scale=1" here. It's bad for accessibility. -->
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		
		<!-- Feel free to split the CSS into separate files, if you like. -->
		<link rel="stylesheet" href="/css/GGS.css"/> 
		
	    <!-- syntax highlighting CSS -->
	    <link rel="stylesheet" href="css/syntax.css" type="text/css" />

	    <!-- Homepage CSS -->
	    <link rel="stylesheet" href="css/screen.css" type="text/css" media="screen, projection" />		
				
		<!-- 
			This script enables structural HTML5 elements in old IE.
			http://code.google.com/p/html5shim/
		-->
		<!--[if lt IE 9]>
			<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	</head>
	
	<body lang="en">
	<a href="http://github.com/zaphpa/zaphpa"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://d3nwyuy0nl342s.cloudfront.net/img/4c7dc970b89fd04b81c8e221ba88ff99a06c6b61/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub"></a>
		
	<section id="main" class="small">	
		<!-- Content begins -->
		
		<section id="column" class="wrapper">
			<!-- This will be replaced by proper TOC through Javascript -->						
		</section><!--/ #column -->
		
		<section id="placeholder">&nbsp;</section>
		
		<section id="content" class="wrapper">
			
			    <h1>What is Zaphpa?</h1>

			<p>Zaphpa is a colleague of <a href="http://www.sinatrarb.com/">Sinatra</a>, wearing a PHPeather hat.</p>

			<!--p><img src="http://gravatar.com/avatar/fc564aeb3c58786c628277b58dd9943c?s=85" /></p-->
			<p>&nbsp;</p>

			<p>Zaphpa is a swiss-army tool for developing RESTful HTTP APIs in PHP. It's a lightweight library that has a single purpose: free API developers from the boilerplate of handling HTTP requests and implementing REST.</p>

			<p>You can think of it as an equivalent of Sinatra (Ruby) or Express.js (Javascript) frameworks for PHP, if you will.</p>

			<h1>Quick Introduction</h1>

			<p>To start serving RESTful HTTP requests, you need to go through three simple steps:</p>

			<ol>
			<li>Setup Zaphpa Library</li>
			<li>Instantiate and configure a router object</li>
			<li>Write callbacks/controllers.</li>
			</ol>


			<h2>Setting Up Zaphpa Library</h2>

			<p>You need to register a PHP script to handle all HTTP requests. For Apache it would look something like the following:</p>

			<pre>
RewriteEngine On
RewriteRule "(^|/)\." - [F]
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !=/favicon.ico
RewriteRule ^ /your_www_root/api.php [NC,NS,L]
			</pre>


			<p>Please note that this configuration is for a httpd.conf, if you are putting it into an .htaccess file, you may want to remove the leading %{DOCUMENT_ROOT} in the corresponding RewriteConds.</p>

			<h2>Instantiating And Configuring A Router</h2>

			<p>For a very simple case of getting specific user object, the code of api.php would look something like:</p>

			<pre>
require_once(dirname(__FILE__) . '/zaphpa/zaphpa.lib.php');

$router = new Zaphpa_Router();

$router->addRoute(array(
      'path'     => '/users/{id}',
      'handlers' => array(
        'id'         => Zaphpa_Constants::PATTERN_DIGIT, //regex
      ),
      'get'      => array('MyController', 'getPage'),
    )
);

$router->route();
			</pre>


			<p>In this example, {id} is a URI parameter, so <code>MyController-&gt;getPage()</code> function will get control to serve URLs like:</p>

			<ul>
			<li>http://example.com/users/32424</li>
			<li>http://example.com/users/23</li>
			</ul>


			<p>However, we asked the library to ascertain that the {id} parameter is a number by attaching a validating handler: "Zaphpa_Constants::PATTERN_DIGIT" to it. As such, following URL will not be handed over to the <code>MyController-&gt;getPage()</code> callback:</p>

			<ul>
			<li>http://example.com/users/ertla</li>
			<li>http://example.com/users/asda32424</li>
			<li>http://example.com/users/32424sfsd</li>
			<li>http://example.com/users/324sdf24</li>
			</ul>


			<h1>Example Controllers/Callbacks</h1>

			<pre>
class MyController {

    public function getPage($req, $res) {
        $res->add(pre($req->params));
        $res->add(pre($req->data));
        $res->send(301);    
    }

    public function postPage($req, $res) {
        $res->add(pre($req->params));
        $res->add(pre($req->data));
        $res->send(301);    
    }

}   

function pre($o) {
  return strtr('&lt;pre&gt;%s&lt;/pre&gt;', 
               array('%s' => print_r($o, true))
         );
}
			</pre>


			<p>When invoked callbacks get two arguments:</p>

			<ol>
			<li>$req (request) object contains data parsed from the request, and can include properties like:

			<ol>
			<li>$params - which contains all the placeholders matched in the URL (e.g. the value of the "id" argument)</li>
			<li>$data  - an array that contains HTTP data. In case of HTTP GET it is: parsed request parameters, for HTTP POST, PUT and DELETE requests: data variables contained in the HTTP Body of the request.</li>
			<li>$version - version of the API if one is versioned (not yet implemented)</li>
			<li>$format - data format that was requested (e.g. XML, JSON etc.)
			 Following is an example request object:
			 <script src="https://gist.github.com/1353603.js?file=HTTPOutput.php"></script></li>
			</ol>
			</li>
			<li>$res (response) object is used to incrementally create content. You can add chunks of text to the output buffer by calling: $res->add (String) and once you are done you can send entire buffer to the HTTP client by issuing: $res->send(&lt;HTTP_RESPONSE_CODE>). HTTP_RESPONSE_CODE is an optional parameter which defaults to (you guessed it:) 200.</li>
			</ol>


			<h1>Convenience Functions</h1>

			<ol>
			<li>$req->get_var('varname') - since $req object populates $data object, you can access request variables (request parameters or HTTP Body data, depending on the type of request) through the array directly. However due to malformed clients or some other application logic, variable may not be set, causing PHP to throw a warning. Instead of having you check each call to $req->data['varname'] on being empty Zaphpa provides a convenience method: $req->get_var('varanme').</li>
			</ol>


			<h1>A More Advanced Router Example</h1>

			<pre>
$router = new Zaphpa_Router();

$router->addRoute(array(
      'path'     => '/pages/{id}/{categories}/{name}/{year}',
      'handlers' => array(
        'id'         => Zaphpa_Constants::PATTERN_DIGIT, //regex
        'categories' => Zaphpa_Constants::PATTERN_ARGS,  //regex
        'name'       => Zaphpa_Constants::PATTERN_ANY,   //regex
        'year'       => 'handle_year',       //callback function
      ),
      'get'      => array('MyController', 'getPage'),
      'post'     => array('MyController', 'postPage'),
      'file'     => 'controllers/mycontroller.php'
    )
);

$router->route();

function handle_year($param) {
  return preg_match('~^\d{4}$~', $param) ? array(
    'ohyesdd' => $param,
    'ba' => 'booooo',
  ) : null;
}
			</pre>


			<h1>Routing to Entities</h1>

			<p>So far we have discussed routing individual URI patterns. However, when building a RESTful API, you often need to create full Resources or Endpoints - API lingo for objects that can be managed in a full: Create, Read, Update, Delete (CRUD) lifecycle.</p>

			<p>One way you can do this is to fully declare all four routes. But that would mean a lot of duplicated configuration. And we hate code duplication, so here's a nifty shortcut you can use:</p>

			<pre>
$router->addRoute(array(
      'path'     => '/books/{id}',
      'handlers' => array(
        'id'         => Zaphpa_Constants::PATTERN_DIGIT, 
      ),
      'get'      => array('MyController', 'getBook'),
      'post'     => array('MyController', 'createBook'),
      'put'      => array('MyController', 'updateBook'),
      'delete'     => array('MyController', 'deleteBook'),
      'file'     => 'controllers/bookcontroller.php'
    )
);
			</pre>						
			
		</section><!--/ #content -->
		
		<!-- content ends -->
			
	</section><!--/ #main -->
				
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
	<script src="http://samaxesjs.googlecode.com/files/jquery.toc-1.1.2.min.js"></script>
	<script src="/js/site.js"></script>		
	
	<!-- Here's Golden Gridlet, the grid overlay script. -->	
	<script src="/js/GGC.js"></script>
	
	</body>
	
</html>